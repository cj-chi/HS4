# 實驗總結：三向比對與 ratio→slider 非線性結論

**日期**：2025-02-27  
**主旨**：舊版／新版／混合 mapping 三向比對，證明「MediaPipe ratio → HS2 滑桿」為非線性關係；總結報告與後續 GitHub 更新要點。

---

## 1. 結論摘要

- **非線性**：同一組 16 個 ratio 上，「誰的誤差最低」在舊／新／混三者間**因參數而異**，無法用單一線性 mapping 同時最優；混合（每參數取該次誤差較低的一版）得到最佳 total_loss，印證 **ratio→slider 為非線性**（遊戲內為 value→動畫曲線→骨骼，且各參數特性不同）。
- **三張圖結果**：混合 < 新版 < 舊版（total_loss：646.29 / 717.91 / 1394.89）；誤差一律以**百分比（%）**表示。
- **產出與命名**：總結檔、報告檔皆建議採「**日期_主旨**」檔名，方便之後整理與 GitHub 更新。

---

## 2. 實驗設計

- **目標圖**：`SRC\9081374d2d746daf66024acde36ada77.jpg`
- **基底卡**：`SRC\AI_191856.png`
- **三種 mapping**：
  - **舊版**：HS4 - Copy (5) 的 `run_poc.py` + 舊 `ratio_to_slider_map.json`（17 項含 face_width_to_height，face_width_to_height_lower = face_w/face_h）
  - **新版**：HS4 的 `run_poc.py` + `ratio_to_slider_map_new_only.json`（16 項，face_width_to_height_lower = jaw_w/face_h）
  - **混合**：HS4 的 `run_poc.py` + `ratio_to_slider_map.json`（由 `build_hybrid_map.py` 依比對結果：舊好用用舊、新好用用新）
- **流程**：各產一張卡 → 各請求一張 HS2 截圖（同一 BepInEx 插件、FOV 自動）→ 以原始 JPG 為目標，對三張截圖做 MediaPipe，計算每項 ratio 誤差（%）與 total_loss。
- **腳本**：`compare_three_way_mediapipe.py`（可 `--launch-game`），沿用既有 run_poc、request_screenshot_and_wait、report_17_ratio_mapping.run_report。三向比對會產出執行時間紀錄（見 `compare_three_way_summary.json` 的 `execution_times` 與另存的 `Output/YYYYMMDD_HHMMSS_三向比對_執行時間.json`），供之後規劃與瓶頸分析參考。

---

## 3. 三張圖誤差結果（單位：%）

### 3.1 總覽

| 版本 | total_loss | 誤差 ≤10% 的項數 |
|------|------------|------------------|
| 舊版 | 1394.89 | 9 / 16 |
| 新版 | 717.91 | 8 / 16 |
| 混合 | **646.29** | 9 / 16 |

### 3.2 各 ratio 誤差（%）：舊 | 新 | 混

| ratio | slider | 舊 (%) | 新 (%) | 混 (%) |
|-------|--------|--------|--------|--------|
| head_width_to_face_height | head_width | 0.79 | 1.43 | 4.95 |
| face_width_to_height_lower | head_lower_width | 16.80 | 4.51 | 2.66 |
| eye_span_to_face_width | eye_span | 4.44 | 4.73 | 0.90 |
| eye_vertical_to_face_height | eye_vertical | 12.10 | 10.25 | 15.98 |
| eye_size_ratio | eye_size | 6.15 | 15.38 | 11.99 |
| eye_angle_z_ratio | eye_angle_z | 31.54 | 0.23 | 4.42 |
| nose_width_to_face_width | nose_width | 9.72 | 25.82 | 17.81 |
| nose_height_to_face_height | nose_height | 8.77 | 1.53 | 3.33 |
| nose_bridge_position_ratio | bridge_height | 4.49 | 11.44 | 11.57 |
| mouth_width_to_face_width | mouth_width | 24.51 | 14.90 | 14.01 |
| mouth_height_to_face_height | mouth_height | 4.61 | 10.53 | 15.63 |
| lip_thickness_to_mouth_width | lip_thickness | 39.81 | 6.75 | 3.37 |
| upper_lip_to_total_lip_ratio | upper_lip_thick | 49.59 | 14.19 | 0.00 |
| lower_lip_to_total_lip_ratio | lower_lip_thick | 9.24 | 2.65 | 0.00 |
| jaw_width_to_face_width | jaw_width | 16.25 | 5.94 | 2.38 |
| chin_to_mouth_face_height | chin_height | 3.66 | 32.89 | 34.13 |

---

## 4. 非線性之證據

- **同一 ratio 上勝出者不同**：例如 eye_angle_z 新版最佳（0.23%）、nose_height 新版最佳（1.53%）、upper_lip / lower_lip 混合最佳（0%）；eye_vertical、mouth_height、chin 等則舊或新或混互有高下。單一線性 mapping 無法在 16 項同時最小化誤差。
- **混合優於單一版**：混合 mapping 依「該次比對誤差較低」選舊或新 calibration，得到三者中最低 total_loss（646.29），顯示**按參數擇優**有效，符合「遊戲內為 value→曲線→骨骼、且各滑桿非線性不同」的假設。
- **文件與程式**：`ratio_to_slider.py`、`docs/17_ratio_to_hs2_slider_對照.md` 已註明 calibration 為線性近似，殘差可依 run_experiment 反饋再調或改為多點／曲線。

---

## 5. 報告與產出檔一覽（檔名建議：日期_主旨）

- **本次三向比對報告**（既有檔，可複製為帶日期版本供整理）：
  - `Output/compare_three_way_summary.md`、`compare_three_way_summary.json`
  - 建議複製命名例：`Output/20250227_三向比對_舊新混誤差表.md`（內容同 summary，方便之後按日期整理）
- **總結檔（本檔）**：
  - `docs/20250227_實驗總結_三向比對與非線性結論.md`
- **既有對照與流程**：
  - `docs/舊版與新版_MediaPipe_slider_mapping_比較.md`
  - `docs/既有已驗證腳本與流程.md`
  - `docs/17_ratio_to_hs2_slider_對照.md`

**命名慣例**：之後新增總結或報告，建議檔名包含 **YYYYMMDD** 與 **主旨**，例如：`YYYYMMDD_主旨.md`、`YYYYMMDD_主旨.json`，方便排序與 GitHub 更新時引用。詳見 `docs/總結與報告檔命名慣例.md`。

---

## 6. 之後 GitHub 更新要點

- **README / 專案說明**：可補充「三向比對實驗證明 ratio→slider 為非線性；混合 mapping（每參數擇優）可改善 total_loss；誤差以百分比（%）表示」。
- **產出與腳本**：列出 `compare_three_way_mediapipe.py`、`build_hybrid_map.py`、`ratio_to_slider_map_hybrid.json`，以及 17 ratio 誤差報告（`report_17_ratio_mapping.py`）與既有流程（見 `docs/既有已驗證腳本與流程.md`）。
- **文件**：可加入或連結 `docs/20250227_實驗總結_三向比對與非線性結論.md`，並註明報告檔命名採「日期_主旨」以利整理。
