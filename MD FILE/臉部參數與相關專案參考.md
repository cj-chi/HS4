# 臉部參數定義與相關專案參考

本文件整理：遊戲臉部參數的定義來源，以及與「照片→臉部參數」相關的既有專案與論文。

---

## 一、我們使用的參數定義從哪來？

- **HS2 / Illusion 臉部滑桿**沒有官方公開的「參數意義」規格書，目前實務上的定義來自：
  1. **HS2CharEdit** 原始碼與介面：  
     [CttCJim/HS2CharEdit](https://github.com/CttCJim/HS2CharEdit) 中對應的 control 名稱與 offset（如 `txt_eyeVertical`、`txt_headWidth` 等），以及「關鍵字 + offset」的讀寫方式。
  2. **本專案對照表**：`ChaFile_變數位置對照表.md`、`ChaFile_format_from_HS2CharEdit.md` 等，是依 HS2CharEdit 與社群逆向整理出的 **shapeValueFace** 對照（offset → 變數名、遊戲值 = round(float×100)、多數滑桿 -100～+200）。
- 因此，「這些數值的定義」在網路上**沒有單一官方文件**，而是來自 **HS2CharEdit + 遊戲存檔格式的逆向**；本專案的文件即是在做這件事的整理。

---

## 二、和我們做類似事情的人與專案

### 1. Face2Parameter（Illusion 遊戲臉部參數）

- **Repo**: [ChasonJiang/Face2Parameter](https://github.com/ChasonJiang/Face2Parameter)
- **在做的事**：用**深度學習**從「圖片」推估 Illusion 遊戲角色的**臉部參數**（和我們「照片→遊戲參數」的目標一致）。
- **做法**：  
  - Stage 1：用 VAE 學圖片的 latent 表示。  
  - Stage 2：用 HS_FACE 資料集（約 14 萬張遊戲臉圖 + 對應的臉部參數）訓練「latent → 臉部參數」的 F2P 模型。  
- **資料集**：HS_FACE（含遊戲內截圖、Stable Diffusion 生成圖、以及**遊戲臉部參數**），需對齊為 256×256。  
- **重點**：他們是「學一個網路直接預測參數」，我們是「MediaPipe 比例 + 校準對應到滑桿」；目標類似，方法不同。Repo 僅寫「Illusion 的遊戲」與 **HS_FACE** 資料集，**未寫明 HS2**；HS2 為依資料集名稱（HS 疑為 Honey Select）與 Illusion 產品推論。參數語意他們也未公開，實務上多依遊戲/HS2CharEdit。
- **本專案試用**：見 **`Face2Parameter_試用說明.md`**；有權重時可用 **`run_face2parameter.py`** 跑推論並輸出 205 維 JSON，與本專案結果比較。

#### HS_FACE 資料集（從 Face2Parameter repo 能看到的）

- **取得**：Repo 只提供**百度網盤**連結，GitHub 上沒有資料集本身。  
  - 連結：[HS_FACE（百度網盤）](https://pan.baidu.com/s/1yPftN5rmtY5QDF7G2RjN4A?pwd=p8qd)
- **README 說明**：約 14 萬張遊戲角色臉圖，包含三部分：  
  1. 遊戲內直接截圖的臉圖；  
  2. 以 1 為條件用 Stable Diffusion 生成、偏真人風的臉圖；  
  3. 對應「1」的遊戲臉部參數。  
  圖片需對齊為 256×256，可跑專案內 `face_alignment.py` 做對齊。
- **程式裡的使用方式**（依 `src/dataset/datasets.py`、`f2p_trainer.py`、`split_data.py` 推論）：  
  - **圖片**：`*.png`，路徑寫在 `data/train.txt`、`data/val.txt`（可來自任意子目錄）。訓練時 resize 為 224×224。  
  - **標註**：`data/labels.json`，格式為 `{ "樣本名稱": [205 個 float], ... }`；樣本名稱常對應檔名（例如 `xxx@yyy` 形式，取 `@` 後當 key）。  
  - **Stage 2 輸入**：先由 VAE 抽出 latent，存成 `data/features/*.npy`（每筆 2048 維 = 1024×2）；train/val 名單為 `train_features.txt`、`val_features.txt`。  
- **臉部參數維度**：**205 維**（`f2p_trainer.py` 的 `out_dim=205`）。註解裡有依「部位」分組的 loss：前 54 維分為 whole(0:5)、chin(5:13)、cheek(13:19)、eye(19:32)、nose(32:47)、mouth(47:54)，其餘 54:205 為「amb」。Repo **沒有**提供這 205 維的參數名稱或與 HS2 滑桿的對照表。

- **若無法使用百度網盤**：目前**沒有**官方或社群公開的替代下載（Google Drive、Hugging Face、鏡像等皆未找到；Repo 的 Issues 也無相關討論）。可行做法：  
  1. 在 [Face2Parameter Issues](https://github.com/ChasonJiang/Face2Parameter/issues) 開一則請求，請作者提供 Google Drive / 其他免登入或國際可用的連結。  
  2. **自建同類型資料**：若有 HS2 環境，可從遊戲內截臉圖，並用本專案的 `read_face_params_from_card.py` 從角色卡讀出 shapeValueFace，產出「圖 + 參數」對，格式可對齊 Face2Parameter 的 `labels.json` 與 train/val 名單（維度需對照 HS2 的滑桿數，若與 205 維不同則要對應或取子集）。

### 2. FDE（Facial Data Extraction，Illusion 角色卡臉部資料）

- **Repo**: [ChasonJiang/FDE](https://github.com/ChasonJiang/FDE)
- **在做的事**：用深度學習從**圖片**擷取臉部資料，轉成 **Illusion 角色卡臉部資料**；支援 **AI Shoujo 與 Honey Select 2**。
- **技術**：FDEv2，結合 residual 特徵與 keypoint 特徵；有 `extractor_face.py`、`extractor_eyes.py`、`extractor_nose.py`、`extractor_mouth.py` 等，可推測是分部位預測再組合成卡牌用參數。
- **重點**：和我們一樣是「圖→Illusion/HS2 臉部資料」，但用學習式特徵而非幾何比例；他們同樣沒有在網路上提供「參數語意」的獨立文件，參數定義仍依遊戲/編輯器。

### 3. Face-to-Parameter（學術：照片→遊戲角色參數）

- **論文**：  
  - ICCV 2019: [Face-to-Parameter Translation for Game Character Auto-Creation](https://arxiv.org/abs/1909.01064)  
  - AAAI 2020: [Fast and Robust Face-to-Parameter Translation for Game Character Auto-Creation](https://aaai.org/papers/01733-fast-and-robust-face-to-parameter-translation-for-game-character-auto-creation)
- **程式**：[FuxiCV/Face-to-Parameter-V2](https://github.com/FuxiCV/Face-to-Parameter-V2)
- **在做的事**：把**真人照片**轉成遊戲角色臉部參數，用於 RPG 角色自動生成；強調「具物理意義的參數」、單次前向推論、可再手動微調。
- **重點**：學術上在做「臉→參數」的定義與預測，但對象是通用遊戲臉部參數，不是 Illusion/HS2 的 shapeValueFace；可參考「參數化、可解釋」的思路，但**具體參數名稱與範圍仍以各遊戲為準**（我們以 HS2CharEdit + ChaFile 為準）。

### 4. 其他相關

- **HS2CharEdit**：[CttCJim/HS2CharEdit](https://github.com/CttCJim/HS2CharEdit) — 讀寫角色卡，本專案 shapeValueFace 的 offset/名稱對照即依此與 ChaFile 格式整理。  
- **illusionsCard**：讀取 Illusion 系角色卡（含 Koikatsu），msgpack 等格式，偏讀取/解析，不是「圖→參數」流程。  
- **fofr/cog-face-to-many**：圖→多種風格（含 3D/遊戲風），非針對 Illusion 參數。

---

## 三、結論（對應你的兩個問題）

1. **這些數值的定義**  
   - 在網路上**沒有** Illusion/HS2 官方釋出的「臉部參數語意文件」。  
   - 實務定義來自：**HS2CharEdit 源碼 + 遊戲存檔格式（ChaFile / shapeValueFace）的逆向**，本專案的 `ChaFile_變數位置對照表.md`、`read_face_params_from_card.py` 的 FACE_OFFSETS 等就是在做這件事。

2. **有沒有人做過一樣的事**  
   - **有**：  
     - **Face2Parameter**、**FDE** 都是「從圖片得到 Illusion 遊戲角色臉部參數」（Face2Parameter 未寫明 HS2，僅寫 Illusion + HS_FACE；FDE 則有寫支援 Honey Select 2），用**深度學習**（VAE + F2P、或 FDEv2 特徵），不是 MediaPipe 比例 + 校準。  
     - **Face-to-Parameter** 論文/實作是做「照片→遊戲臉部參數」的通用方法，已實際部署於遊戲中，但對象不是 HS2 的 shapeValueFace。  
   - 用 **MediaPipe 臉部比例 + 校準區間對應到 HS2 滑桿** 的做法，在搜尋結果中沒有找到現成專案，可視為本專案目前的特色做法。

若要進一步對齊「學術參數語意」或「其他遊戲的參數命名」，可再針對 Face-to-Parameter 論文中的參數列表或 FDE/Face2Parameter 的輸出欄位做對照；本專案仍以 **HS2CharEdit + ChaFile 對照表** 為參數定義的依據。
